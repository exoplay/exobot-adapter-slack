{"version":3,"sources":["webpack:///webpack/bootstrap 1b133167bf450ac7709b","webpack:///external \"@exoplay/exobot\"","webpack:///external \"@slack/client\"","webpack:///external \"@slack/client/lib/models\"","webpack:///./slack.js"],"names":["dmName","models","DM","_modelName","EVENTS","CLIENT_EVENTS","RTM","CONNECTING","RTM_CONNECTION_OPENED","AUTHENTICATED","DISCONNECT","UNABLE_TO_RTM_START","ATTEMPTING_RECONNECT","RTM_EVENTS","MESSAGE","SlackAdapter","token","adapterName","arguments","name","bot","client","logLevel","Object","keys","forEach","slackEvent","mappedFn","on","bind","args","emitter","emit","start","message","text","log","debug","channel","sendMessage","info","status","Adapter","STATUS","notice","CONNECTED","critical","DISCONNECTED","RECONNECTING","userId","adapterUsers","roleMapping","roles","filter","role","map","adapterUserId","adapterUser","is_admin","push","is_owner","user","botId","activeUserId","slackUser","dataStore","getUserById","getUser","id","getChannelGroupOrDMById","getUserByName","botUser","err","warn","type"],"mappings":"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","file":"slack.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1b133167bf450ac7709b","module.exports = require(\"@exoplay/exobot\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@exoplay/exobot\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"@slack/client\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@slack/client\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"@slack/client/lib/models\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@slack/client/lib/models\"\n// module id = 2\n// module chunks = 0","import {\n  RtmClient,\n  CLIENT_EVENTS,\n  RTM_EVENTS,\n  //MemoryDataStore,\n} from '@slack/client';\n\nimport models from '@slack/client/lib/models';\n\nimport { Adapter } from '@exoplay/exobot';\n\nconst dmName = new models.DM()._modelName;\n\nexport const EVENTS = {\n  [CLIENT_EVENTS.RTM.CONNECTING]: 'slackConnecting',\n  [CLIENT_EVENTS.RTM.RTM_CONNECTION_OPENED]: 'slackConnected',\n  [CLIENT_EVENTS.RTM.AUTHENTICATED]: 'slackAuthenticated',\n  [CLIENT_EVENTS.RTM.DISCONNECT]: 'slackDisconnected',\n  [CLIENT_EVENTS.RTM.UNABLE_TO_RTM_START]: 'slackUnableToStart',\n  [CLIENT_EVENTS.RTM.ATTEMPTING_RECONNECT]: 'slackReconnecting',\n  [RTM_EVENTS.MESSAGE]: 'slackMessage',\n};\n\nexport default class SlackAdapter extends Adapter {\n  static type = 'slack';\n\n  constructor ({ token, adapterName}) {\n    super(...arguments);\n    this.token = token;\n    this.name = adapterName || this.name;\n  }\n\n  register (bot) {\n    super.register(...arguments);\n    const { token } = this;\n\n    this.client = new RtmClient(token, { logLevel: bot.logLevel });\n\n    Object.keys(EVENTS).forEach(slackEvent => {\n      const mappedFn = this[EVENTS[slackEvent]];\n      this.client.on(slackEvent, mappedFn.bind(this));\n      this.client.on(slackEvent, (...args) => {\n        bot.emitter.emit(`slack-${slackEvent}`, ...args);\n      });\n    });\n\n    this.client.start();\n  }\n\n  send (message) {\n    if (message.text) {\n      this.bot.log.debug(`Sending ${message.text} to ${message.channel}`);\n      this.client.sendMessage(message.text, message.channel);\n    }\n  }\n\n  slackConnecting () {\n    this.bot.log.info('Connecting to Slack.');\n    this.status = Adapter.STATUS.CONNECTING;\n  }\n\n  slackConnected () {\n    this.bot.log.info('Connected to Slack.');\n  }\n\n  slackAuthenticated () {\n    this.bot.log.notice('Successfully authenticated to Slack.');\n    this.status = Adapter.STATUS.CONNECTED;\n  }\n\n  slackDisconnected () {\n    this.bot.log.critical('Disconnected from Slack.');\n    this.status = Adapter.STATUS.DISCONNECTED;\n  }\n\n  slackUnableToStart () {\n    this.bot.log.critical('Unable to start Slack.');\n    this.status = Adapter.STATUS.DISCONNECTED;\n  }\n\n  slackReconnecting () {\n    this.bot.log.notice('Reconnecting to Slack.');\n    this.status = Adapter.STATUS.RECONNECTING;\n  }\n\n  getRolesForUser (userId) {\n    if (this.adapterUsers && this.roleMapping && this.adapterUsers[userId]) {\n      return this.adapterUsers[userId].roles\n        .filter(role => this.roleMapping[role])\n        .map(role => this.roleMapping[role]);\n    }\n\n    return [];\n  }\n\n  getRoles(adapterUserId, adapterUser) {\n    const roles = [];\n    if (adapterUser) {\n      if (adapterUser.is_admin) {\n        roles.push('admin');\n      }\n\n      if (adapterUser.is_owner) {\n        roles.push('owner');\n      }\n      return roles;\n    }\n\n    return false;\n  }\n\n  async slackMessage (message) {\n    let user;\n    if (!message.text) { return; }\n\n    const botId = this.client.activeUserId;\n    if (message.user === botId) { return; }\n\n    this.bot.log.debug(message.text);\n    const slackUser = this.client.dataStore.getUserById(message.user);\n\n    if (slackUser) {\n      user = await this.getUser(slackUser.id, slackUser.name, slackUser);\n    } else {\n      user = await this.getUser(message.user, undefined, slackUser);\n    }\n\n    const channel = this.client.dataStore.getChannelGroupOrDMById(message.channel);\n\n    if (message.text) {\n      if (channel && channel._modelName === dmName) {\n        return super.receiveWhisper({ user, text: message.text, channel: message.channel });\n      }\n\n      super.receive({ user, text: message.text, channel: message.channel });\n    }\n  }\n\n  async getUserIdByUserName (name) {\n    const user = this.client.dataStore.getUserByName(name);\n    if (user) {\n      let botUser;\n      try {\n        botUser = await this.getUser(user.id, user.name, user);\n      } catch (err) {\n        this.bot.log.warn(err)\n      }\n\n      return botUser.id;\n    }\n\n    return;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./slack.js"],"sourceRoot":""}