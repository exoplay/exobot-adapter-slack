require("source-map-support").install(),require("regenerator-runtime/runtime"),function(t,e){for(var n in e)t[n]=e[n]}(exports,function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,e,n){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(t,e){t.exports=require("@exoplay/exobot")},function(t,e){t.exports=require("@slack/client")},function(t,e){t.exports=require("@slack/client/lib/models")},function(t,e,n){"use strict";function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(o,a){try{var i=e[o](a),c=i.value}catch(t){return void n(t)}return i.done?void t(c):Promise.resolve(c).then(function(t){r("next",t)},function(t){r("throw",t)})}return r("next")})}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=n(1),s=(n.n(c),n(2)),u=n.n(s),l=n(0);n.n(l);n.d(e,"EVENTS",function(){return h}),n.d(e,"SlackAdapter",function(){return d});var p,f=(new u.a.DM)._modelName,h=(p={},p[c.CLIENT_EVENTS.RTM.CONNECTING]="slackConnecting",p[c.CLIENT_EVENTS.RTM.RTM_CONNECTION_OPENED]="slackConnected",p[c.CLIENT_EVENTS.RTM.AUTHENTICATED]="slackAuthenticated",p[c.CLIENT_EVENTS.RTM.DISCONNECT]="slackDisconnected",p[c.CLIENT_EVENTS.RTM.UNABLE_TO_RTM_START]="slackUnableToStart",p[c.CLIENT_EVENTS.RTM.ATTEMPTING_RECONNECT]="slackReconnecting",p[c.RTM_EVENTS.MESSAGE]="slackMessage",p),d=function(t){function e(n){var r=n.token,i=n.adapterName;o(this,e);var c=a(this,t.apply(this,arguments));return c.name="Slack",c.token=r,c.name=i||c.name,c}return i(e,t),e.prototype.register=function(e){var n,r=this;(n=t.prototype.register).call.apply(n,[this].concat(Array.prototype.slice.call(arguments)));var o=this.token;this.client=new c.RtmClient(o,{logLevel:e.logLevel}),Object.keys(h).forEach(function(t){var n=r[h[t]];r.client.on(t,n.bind(r)),r.client.on(t,function(){for(var n,r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];(n=e.emitter).emit.apply(n,["slack-"+t].concat(o))})}),this.client.start()},e.prototype.send=function(t){t.text&&(this.bot.log.debug("Sending "+t.text+" to "+t.channel),this.client.sendMessage(t.text,t.channel))},e.prototype.slackConnecting=function(){this.bot.log.info("Connecting to Slack."),this.status=l.Adapter.STATUS.CONNECTING},e.prototype.slackConnected=function(){this.bot.log.info("Connected to Slack.")},e.prototype.slackAuthenticated=function(){this.bot.log.notice("Successfully authenticated to Slack."),this.status=l.Adapter.STATUS.CONNECTED},e.prototype.slackDisconnected=function(){this.bot.log.critical("Disconnected from Slack."),this.status=l.Adapter.STATUS.DISCONNECTED},e.prototype.slackUnableToStart=function(){this.bot.log.critical("Unable to start Slack."),this.status=l.Adapter.STATUS.DISCONNECTED},e.prototype.slackReconnecting=function(){this.bot.log.notice("Reconnecting to Slack."),this.status=l.Adapter.STATUS.RECONNECTING},e.prototype.getRolesForUser=function(t){var e=this;return this.adapterUsers&&this.roleMapping&&this.adapterUsers[t]?this.adapterUsers[t].roles.filter(function(t){return e.roleMapping[t]}).map(function(t){return e.roleMapping[t]}):[]},e.prototype.getRoles=function(t,e){var n=[];return!!e&&(e.is_admin&&n.push("admin"),e.is_owner&&n.push("owner"),n)},e.prototype.slackMessage=function(){function e(t){return n.apply(this,arguments)}var n=r(regeneratorRuntime.mark(function e(n){var r,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,n.text){e.next=3;break}return e.abrupt("return");case 3:if(o=this.client.activeUserId,n.user!==o){e.next=6;break}return e.abrupt("return");case 6:if(this.bot.log.debug(n.text),a=this.client.dataStore.getUserById(n.user),!a){e.next=14;break}return e.next=11,this.getUser(a.id,a.name,a);case 11:r=e.sent,e.next=17;break;case 14:return e.next=16,this.getUser(n.user,void 0,a);case 16:r=e.sent;case 17:if(i=this.client.dataStore.getChannelGroupOrDMById(n.channel),!n.text){e.next=22;break}if(!i||i._modelName!==f){e.next=21;break}return e.abrupt("return",t.prototype.receiveWhisper.call(this,{user:r,text:n.text,channel:n.channel}));case 21:t.prototype.receive.call(this,{user:r,text:n.text,channel:n.channel});case 22:case"end":return e.stop()}},e,this)}));return e}(),e.prototype.getUserIdByUserName=function(){function t(t){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function t(e){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.client.dataStore.getUserByName(e),!n){t.next=13;break}return r=void 0,t.prev=3,t.next=6,this.getUser(n.id,n.name,n);case 6:r=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),this.bot.log.warn(t.t0);case 12:return t.abrupt("return",r.id);case 13:return t.abrupt("return");case 14:case"end":return t.stop()}},t,this,[[3,9]])}));return t}(),e}(l.Adapter)}]));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc2xhY2suanMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIDNlZGNiN2IxYWY1NjkwM2YzNTZkIiwid2VicGFjazovLy9leHRlcm5hbCBcIkBleG9wbGF5L2V4b2JvdFwiIiwid2VicGFjazovLy9leHRlcm5hbCBcIkBzbGFjay9jbGllbnRcIiIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJAc2xhY2svY2xpZW50L2xpYi9tb2RlbHNcIiIsIndlYnBhY2s6Ly8vLi9zbGFjay5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiaW5zdGFsbCIsImUiLCJhIiwiaSIsImV4cG9ydHMiLCJtb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsIm1vZHVsZSIsImwiLCJjYWxsIiwibSIsImMiLCJ2YWx1ZSIsImQiLCJuYW1lIiwiZ2V0dGVyIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwibiIsIl9fZXNNb2R1bGUiLCJvIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiX2FzeW5jVG9HZW5lcmF0b3IiLCJmbiIsImdlbiIsImFwcGx5IiwidGhpcyIsImFyZ3VtZW50cyIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwic3RlcCIsImtleSIsImFyZyIsImluZm8iLCJlcnJvciIsImRvbmUiLCJ0aGVuIiwiZXJyIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIiwic2VsZiIsIlJlZmVyZW5jZUVycm9yIiwiX2luaGVyaXRzIiwic3ViQ2xhc3MiLCJzdXBlckNsYXNzIiwiY3JlYXRlIiwiY29uc3RydWN0b3IiLCJ3cml0YWJsZSIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19zbGFja19jbGllbnRfXyIsIl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fc2xhY2tfY2xpZW50X2xpYl9tb2RlbHNfXyIsIl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fc2xhY2tfY2xpZW50X2xpYl9tb2RlbHNfX19kZWZhdWx0IiwiX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8yX19leG9wbGF5X2V4b2JvdF9fIiwiRVZFTlRTIiwiU2xhY2tBZGFwdGVyIiwiX0VWRU5UUyIsImRtTmFtZSIsIkRNIiwiX21vZGVsTmFtZSIsIlJUTSIsIkNPTk5FQ1RJTkciLCJSVE1fQ09OTkVDVElPTl9PUEVORUQiLCJBVVRIRU5USUNBVEVEIiwiRElTQ09OTkVDVCIsIlVOQUJMRV9UT19SVE1fU1RBUlQiLCJBVFRFTVBUSU5HX1JFQ09OTkVDVCIsIk1FU1NBR0UiLCJfQWRhcHRlciIsIl9yZWYiLCJ0b2tlbiIsImFkYXB0ZXJOYW1lIiwiX3RoaXMiLCJyZWdpc3RlciIsImJvdCIsIl9BZGFwdGVyJHByb3RvdHlwZSRyZSIsIl90aGlzMiIsImNvbmNhdCIsIkFycmF5Iiwic2xpY2UiLCJjbGllbnQiLCJsb2dMZXZlbCIsImtleXMiLCJmb3JFYWNoIiwic2xhY2tFdmVudCIsIm1hcHBlZEZuIiwib24iLCJiaW5kIiwiX2JvdCRlbWl0dGVyIiwiX2xlbiIsImxlbmd0aCIsImFyZ3MiLCJfa2V5IiwiZW1pdHRlciIsImVtaXQiLCJzdGFydCIsInNlbmQiLCJtZXNzYWdlIiwidGV4dCIsImxvZyIsImRlYnVnIiwiY2hhbm5lbCIsInNlbmRNZXNzYWdlIiwic2xhY2tDb25uZWN0aW5nIiwic3RhdHVzIiwiU1RBVFVTIiwic2xhY2tDb25uZWN0ZWQiLCJzbGFja0F1dGhlbnRpY2F0ZWQiLCJub3RpY2UiLCJDT05ORUNURUQiLCJzbGFja0Rpc2Nvbm5lY3RlZCIsImNyaXRpY2FsIiwiRElTQ09OTkVDVEVEIiwic2xhY2tVbmFibGVUb1N0YXJ0Iiwic2xhY2tSZWNvbm5lY3RpbmciLCJSRUNPTk5FQ1RJTkciLCJnZXRSb2xlc0ZvclVzZXIiLCJ1c2VySWQiLCJfdGhpczMiLCJhZGFwdGVyVXNlcnMiLCJyb2xlTWFwcGluZyIsInJvbGVzIiwiZmlsdGVyIiwicm9sZSIsIm1hcCIsImdldFJvbGVzIiwiYWRhcHRlclVzZXJJZCIsImFkYXB0ZXJVc2VyIiwiaXNfYWRtaW4iLCJwdXNoIiwiaXNfb3duZXIiLCJzbGFja01lc3NhZ2UiLCJfeCIsIl9yZWYyIiwicmVnZW5lcmF0b3JSdW50aW1lIiwibWFyayIsIl9jYWxsZWUiLCJ1c2VyIiwiYm90SWQiLCJzbGFja1VzZXIiLCJ3cmFwIiwiX2NvbnRleHQiLCJwcmV2IiwibmV4dCIsImFicnVwdCIsImFjdGl2ZVVzZXJJZCIsImRhdGFTdG9yZSIsImdldFVzZXJCeUlkIiwiZ2V0VXNlciIsImlkIiwic2VudCIsInVuZGVmaW5lZCIsImdldENoYW5uZWxHcm91cE9yRE1CeUlkIiwicmVjZWl2ZVdoaXNwZXIiLCJyZWNlaXZlIiwic3RvcCIsImdldFVzZXJJZEJ5VXNlck5hbWUiLCJfeDIiLCJfcmVmMyIsIl9jYWxsZWUyIiwiYm90VXNlciIsIl9jb250ZXh0MiIsImdldFVzZXJCeU5hbWUiLCJ0MCIsIndhcm4iXSwibWFwcGluZ3MiOiJBQUFBQSxRQUFRLHNCQUFzQkMsVUFBVUQsUUFBUSwrQkFDL0MsU0FBU0UsRUFBR0MsR0FBSyxJQUFJLEdBQUlDLEtBQUtELEdBQUdELEVBQUVFLEdBQUtELEVBQUVDLElBQU1DLFFBQWtCLFNBQVVDLEdDRzdFLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsRUFBQUQsR0FDQSxNQUFBQyxHQUFBRCxHQUFBSCxPQUdBLElBQUFLLEdBQUFELEVBQUFELElBQ0FKLEVBQUFJLEVBQ0FHLEdBQUEsRUFDQU4sV0FVQSxPQU5BQyxHQUFBRSxHQUFBSSxLQUFBRixFQUFBTCxRQUFBSyxJQUFBTCxRQUFBRSxHQUdBRyxFQUFBQyxHQUFBLEVBR0FELEVBQUFMLFFBdkJBLEdBQUFJLEtBNkRBLE9BakNBRixHQUFBTSxFQUFBUCxFQUdBQyxFQUFBTyxFQUFBTCxFQUdBRixFQUFBSCxFQUFBLFNBQUFXLEdBQTJDLE1BQUFBLElBRzNDUixFQUFBUyxFQUFBLFNBQUFYLEVBQUFZLEVBQUFDLEdBQ0FDLE9BQUFDLGVBQUFmLEVBQUFZLEdBQ0FJLGNBQUEsRUFDQUMsWUFBQSxFQUNBQyxJQUFBTCxLQUtBWCxFQUFBaUIsRUFBQSxTQUFBZCxHQUNBLEdBQUFRLEdBQUFSLEtBQUFlLFdBQ0EsV0FBMkIsTUFBQWYsR0FBQSxTQUMzQixXQUFpQyxNQUFBQSxHQUVqQyxPQURBSCxHQUFBUyxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFYLEVBQUFtQixFQUFBLFNBQUFDLEVBQUFDLEdBQXNELE1BQUFULFFBQUFVLFVBQUFDLGVBQUFsQixLQUFBZSxFQUFBQyxJQUd0RHJCLEVBQUF3QixFQUFBLEdBR0F4QixJQUFBeUIsRUFBQSxLRE9NLFNBQVN0QixFQUFRTCxHRXJFdkJLLEVBQUFMLFFBQUFMLFFBQUEsb0JGMkVNLFNBQVNVLEVBQVFMLEdHM0V2QkssRUFBQUwsUUFBQUwsUUFBQSxrQkhpRk0sU0FBU1UsRUFBUUwsR0lqRnZCSyxFQUFBTCxRQUFBTCxRQUFBLDZCSnVGTSxTQUFTVSxFQUFRTCxFQUFTRSxHQUVoQyxZQVdBLFNBQVMwQixHQUFrQkMsR0FBTSxNQUFPLFlBQWMsR0FBSUMsR0FBTUQsRUFBR0UsTUFBTUMsS0FBTUMsVUFBWSxPQUFPLElBQUlDLFNBQVEsU0FBVUMsRUFBU0MsR0FBVSxRQUFTQyxHQUFLQyxFQUFLQyxHQUFPLElBQU0sR0FBSUMsR0FBT1YsRUFBSVEsR0FBS0MsR0FBVTdCLEVBQVE4QixFQUFLOUIsTUFBUyxNQUFPK0IsR0FBd0IsV0FBZkwsR0FBT0ssR0FBa0IsTUFBSUQsR0FBS0UsU0FBUVAsR0FBUXpCLEdBQXdCd0IsUUFBUUMsUUFBUXpCLEdBQU9pQyxLQUFLLFNBQVVqQyxHQUFTMkIsRUFBSyxPQUFRM0IsSUFBVyxTQUFVa0MsR0FBT1AsRUFBSyxRQUFTTyxLQUFjLE1BQU9QLEdBQUssV0FFemIsUUFBU1EsR0FBZ0JDLEVBQVVDLEdBQWUsS0FBTUQsWUFBb0JDLElBQWdCLEtBQU0sSUFBSUMsV0FBVSxxQ0FFaEgsUUFBU0MsR0FBMkJDLEVBQU0zQyxHQUFRLElBQUsyQyxFQUFRLEtBQU0sSUFBSUMsZ0JBQWUsNERBQWdFLFFBQU81QyxHQUF5QixnQkFBVEEsSUFBcUMsa0JBQVRBLEdBQThCMkMsRUFBUDNDLEVBRWxPLFFBQVM2QyxHQUFVQyxFQUFVQyxHQUFjLEdBQTBCLGtCQUFmQSxJQUE0QyxPQUFmQSxFQUF1QixLQUFNLElBQUlOLFdBQVUsaUVBQW9FTSxHQUFlRCxHQUFTN0IsVUFBWVYsT0FBT3lDLE9BQU9ELEdBQWNBLEVBQVc5QixXQUFhZ0MsYUFBZTlDLE1BQU8yQyxFQUFVcEMsWUFBWSxFQUFPd0MsVUFBVSxFQUFNekMsY0FBYyxLQUFlc0MsSUFBWXhDLE9BQU80QyxlQUFpQjVDLE9BQU80QyxlQUFlTCxFQUFVQyxHQUFjRCxFQUFTTSxVQUFZTCxHQWhCNWMsR0FBSU0sR0FBOEMxRCxFQUFvQixHQUVsRTJELEdBRHNEM0QsRUFBb0JpQixFQUFFeUMsR0FDbkIxRCxFQUFvQixJQUM3RTRELEVBQWlFNUQsRUFBb0JpQixFQUFFMEMsR0FDdkZFLEVBQWdEN0QsRUFBb0IsRUFDWkEsR0FBb0JpQixFQUFFNEMsRUFDeEU3RCxHQUFvQlMsRUFBRVgsRUFBUyxTQUFVLFdBQWEsTUFBT2dFLEtBQzdEOUQsRUFBb0JTLEVBQUVYLEVBQVMsZUFBZ0IsV0FBYSxNQUFPaUUsSUFDbEcsSUFBSUMsR0t2RkVDLEdBQVMsR0FBSUwsR0FBQWhFLEVBQU9zRSxJQUFLQyxXQUVsQkwsVUFDVkosRUFBQSxjQUFjVSxJQUFJQyxZQUFhLGtCQURyQkwsRUFFVk4sRUFBQSxjQUFjVSxJQUFJRSx1QkFBd0IsaUJBRmhDTixFQUdWTixFQUFBLGNBQWNVLElBQUlHLGVBQWdCLHFCQUh4QlAsRUFJVk4sRUFBQSxjQUFjVSxJQUFJSSxZQUFhLG9CQUpyQlIsRUFLVk4sRUFBQSxjQUFjVSxJQUFJSyxxQkFBc0IscUJBTDlCVCxFQU1WTixFQUFBLGNBQWNVLElBQUlNLHNCQUF1QixvQkFOL0JWLEVBT1ZOLEVBQUEsV0FBV2lCLFNBQVUsZUFQWFgsR0FVQUQsRUFBYixTQUFBYSxHQUdFLFFBQUFiLEdBQUFjLEdBQW9DLEdBQXJCQyxHQUFxQkQsRUFBckJDLE1BQU9DLEVBQWNGLEVBQWRFLFdBQWNwQyxHQUFBYixLQUFBaUMsRUFBQSxJQUFBaUIsR0FBQWpDLEVBQUFqQixLQUNsQzhDLEVBQUEvQyxNQUFBQyxLQUFTQyxXQUR5QixPQUFBaUQsR0FGcEN0RSxLQUFPLFFBSUxzRSxFQUFLRixNQUFRQSxFQUNiRSxFQUFLdEUsS0FBT3FFLEdBQWVDLEVBQUt0RSxLQUhFc0UsRUFIdEMsTUFBQTlCLEdBQUFhLEVBQUFhLEdBQUFiLEVBQUF6QyxVQVNFMkQsU0FURixTQVNZQyxHQUFLLEdBQUFDLEdBQUFDLEVBQUF0RCxNQUNicUQsRUFBQVAsRUFBQXRELFVBQU0yRCxVQUFONUUsS0FBQXdCLE1BQUFzRCxHQUFBckQsTUFBQXVELE9BQUFDLE1BQUFoRSxVQUFBaUUsTUFBQWxGLEtBQWtCMEIsWUFETCxJQUVMK0MsR0FBVWhELEtBQVZnRCxLQUVSaEQsTUFBSzBELE9BQVMsR0FBSTlCLEdBQUEsVUFBVW9CLEdBQVNXLFNBQVVQLEVBQUlPLFdBRW5EN0UsT0FBTzhFLEtBQUs1QixHQUFRNkIsUUFBUSxTQUFBQyxHQUMxQixHQUFNQyxHQUFXVCxFQUFLdEIsRUFBTzhCLEdBQzdCUixHQUFLSSxPQUFPTSxHQUFHRixFQUFZQyxFQUFTRSxLQUFUWCxJQUMzQkEsRUFBS0ksT0FBT00sR0FBR0YsRUFBWSxXQUFhLE9BQUFJLEdBQUFDLEVBQUFsRSxVQUFBbUUsT0FBVEMsRUFBU2IsTUFBQVcsR0FBQUcsRUFBQSxFQUFBQSxFQUFBSCxFQUFBRyxJQUFURCxFQUFTQyxHQUFBckUsVUFBQXFFLElBQ3RDSixFQUFBZCxFQUFJbUIsU0FBUUMsS0FBWnpFLE1BQUFtRSxHQUFBLFNBQTBCSixHQUExQlAsT0FBMkNjLFFBSS9DckUsS0FBSzBELE9BQU9lLFNBdkJoQnhDLEVBQUF6QyxVQTBCRWtGLEtBMUJGLFNBMEJRQyxHQUNBQSxFQUFRQyxPQUNWNUUsS0FBS29ELElBQUl5QixJQUFJQyxNQUFiLFdBQThCSCxFQUFRQyxLQUF0QyxPQUFpREQsRUFBUUksU0FDekQvRSxLQUFLMEQsT0FBT3NCLFlBQVlMLEVBQVFDLEtBQU1ELEVBQVFJLFdBN0JwRDlDLEVBQUF6QyxVQWlDRXlGLGdCQWpDRixXQWtDSWpGLEtBQUtvRCxJQUFJeUIsSUFBSXJFLEtBQUssd0JBQ2xCUixLQUFLa0YsT0FBU25ELEVBQUEsUUFBUW9ELE9BQU81QyxZQW5DakNOLEVBQUF6QyxVQXNDRTRGLGVBdENGLFdBdUNJcEYsS0FBS29ELElBQUl5QixJQUFJckUsS0FBSyx3QkF2Q3RCeUIsRUFBQXpDLFVBMENFNkYsbUJBMUNGLFdBMkNJckYsS0FBS29ELElBQUl5QixJQUFJUyxPQUFPLHdDQUNwQnRGLEtBQUtrRixPQUFTbkQsRUFBQSxRQUFRb0QsT0FBT0ksV0E1Q2pDdEQsRUFBQXpDLFVBK0NFZ0csa0JBL0NGLFdBZ0RJeEYsS0FBS29ELElBQUl5QixJQUFJWSxTQUFTLDRCQUN0QnpGLEtBQUtrRixPQUFTbkQsRUFBQSxRQUFRb0QsT0FBT08sY0FqRGpDekQsRUFBQXpDLFVBb0RFbUcsbUJBcERGLFdBcURJM0YsS0FBS29ELElBQUl5QixJQUFJWSxTQUFTLDBCQUN0QnpGLEtBQUtrRixPQUFTbkQsRUFBQSxRQUFRb0QsT0FBT08sY0F0RGpDekQsRUFBQXpDLFVBeURFb0csa0JBekRGLFdBMERJNUYsS0FBS29ELElBQUl5QixJQUFJUyxPQUFPLDBCQUNwQnRGLEtBQUtrRixPQUFTbkQsRUFBQSxRQUFRb0QsT0FBT1UsY0EzRGpDNUQsRUFBQXpDLFVBOERFc0csZ0JBOURGLFNBOERtQkMsR0FBUSxHQUFBQyxHQUFBaEcsSUFDdkIsT0FBSUEsTUFBS2lHLGNBQWdCakcsS0FBS2tHLGFBQWVsRyxLQUFLaUcsYUFBYUYsR0FDdEQvRixLQUFLaUcsYUFBYUYsR0FBUUksTUFDOUJDLE9BQU8sU0FBQUMsR0FBQSxNQUFRTCxHQUFLRSxZQUFZRyxLQUNoQ0MsSUFBSSxTQUFBRCxHQUFBLE1BQVFMLEdBQUtFLFlBQVlHLFNBbEV0Q3BFLEVBQUF6QyxVQXdFRStHLFNBeEVGLFNBd0VXQyxFQUFlQyxHQUN0QixHQUFNTixLQUNOLFNBQUlNLElBQ0VBLEVBQVlDLFVBQ2RQLEVBQU1RLEtBQUssU0FHVEYsRUFBWUcsVUFDZFQsRUFBTVEsS0FBSyxTQUVOUixJQWxGYmxFLEVBQUF6QyxVQXdGUXFILGFBeEZSLG1CQUFBQSxHQUFBQyxHQUFBLE1BQUFDLEdBQUFoSCxNQUFBQyxLQUFBQyxXQUFBLEdBQUE4RyxHQUFBbkgsRUFBQW9ILG1CQUFBQyxLQUFBLFFBQUFDLEdBd0ZzQnZDLEdBeEZ0QixHQUFBd0MsR0FBQUMsRUFBQUMsRUFBQXRDLENBQUEsT0FBQWlDLG9CQUFBTSxLQUFBLFNBQUFDLEdBQUEsY0FBQUEsRUFBQUMsS0FBQUQsRUFBQUUsTUFBQSxVQXlGUU4sRUF6RlIsT0EwRlN4QyxFQUFRQyxLQTFGakIsQ0FBQTJDLEVBQUFFLEtBQUEsY0FBQUYsR0FBQUcsT0FBQSxvQkE0RlVOLEVBQVFwSCxLQUFLMEQsT0FBT2lFLGFBQ3RCaEQsRUFBUXdDLE9BQVNDLEVBN0Z6QixDQUFBRyxFQUFBRSxLQUFBLGNBQUFGLEdBQUFHLE9BQUEsb0JBK0ZJMUgsS0FBS29ELElBQUl5QixJQUFJQyxNQUFNSCxFQUFRQyxNQUNyQnlDLEVBQVlySCxLQUFLMEQsT0FBT2tFLFVBQVVDLFlBQVlsRCxFQUFRd0MsT0FFeERFLEVBbEdSLENBQUFFLEVBQUFFLEtBQUEsZUFBQUYsR0FBQUUsS0FBQSxHQW1HbUJ6SCxLQUFLOEgsUUFBUVQsRUFBVVUsR0FBSVYsRUFBVXpJLEtBQU15SSxFQW5HOUQsU0FtR01GLEVBbkdOSSxFQUFBUyxLQUFBVCxFQUFBRSxLQUFBLHVCQUFBRixHQUFBRSxLQUFBLEdBcUdtQnpILEtBQUs4SCxRQUFRbkQsRUFBUXdDLEtBQU1jLE9BQVdaLEVBckd6RCxTQXFHTUYsRUFyR05JLEVBQUFTLElBQUEsWUF3R1VqRCxFQUFVL0UsS0FBSzBELE9BQU9rRSxVQUFVTSx3QkFBd0J2RCxFQUFRSSxVQUVsRUosRUFBUUMsS0ExR2hCLENBQUEyQyxFQUFBRSxLQUFBLGFBMkdVMUMsR0FBV0EsRUFBUTFDLGFBQWVGLEVBM0c1QyxDQUFBb0YsRUFBQUUsS0FBQSxlQUFBRixHQUFBRyxPQUFBLFNBNEdlNUUsRUFBQXRELFVBQU0ySSxlQUFONUosS0FBQXlCLE1BQXVCbUgsT0FBTXZDLEtBQU1ELEVBQVFDLEtBQU1HLFFBQVNKLEVBQVFJLFVBNUdqRixTQStHTWpDLEVBQUF0RCxVQUFNNEksUUFBTjdKLEtBQUF5QixNQUFnQm1ILE9BQU12QyxLQUFNRCxFQUFRQyxLQUFNRyxRQUFTSixFQUFRSSxTQS9HakUseUJBQUF3QyxHQUFBYyxTQUFBbkIsRUFBQWxILFFBQUEsT0FBQTZHLE1BQUE1RSxFQUFBekMsVUFtSFE4SSxvQkFuSFIsbUJBQUFBLEdBQUFDLEdBQUEsTUFBQUMsR0FBQXpJLE1BQUFDLEtBQUFDLFdBQUEsR0FBQXVJLEdBQUE1SSxFQUFBb0gsbUJBQUFDLEtBQUEsUUFBQXdCLEdBbUg2QjdKLEdBbkg3QixHQUFBdUksR0FBQXVCLENBQUEsT0FBQTFCLG9CQUFBTSxLQUFBLFNBQUFxQixHQUFBLGNBQUFBLEVBQUFuQixLQUFBbUIsRUFBQWxCLE1BQUEsVUFvSFVOLEVBQU9uSCxLQUFLMEQsT0FBT2tFLFVBQVVnQixjQUFjaEssSUFDN0N1SSxFQXJIUixDQUFBd0IsRUFBQWxCLEtBQUEsZUFzSFVpQixHQXRIVixPQUFBQyxFQUFBbkIsS0FBQSxFQUFBbUIsRUFBQWxCLEtBQUEsRUF3SHdCekgsS0FBSzhILFFBQVFYLEVBQUtZLEdBQUlaLEVBQUt2SSxLQUFNdUksRUF4SHpELFFBd0hRdUIsRUF4SFJDLEVBQUFYLEtBQUFXLEVBQUFsQixLQUFBLGdCQUFBa0IsRUFBQW5CLEtBQUEsRUFBQW1CLEVBQUFFLEdBQUFGLEVBQUEsU0EwSFEzSSxLQUFLb0QsSUFBSXlCLElBQUlpRSxLQUFiSCxFQUFBRSxHQTFIUixlQUFBRixHQUFBakIsT0FBQSxTQTZIYWdCLEVBQVFYLEdBN0hyQixlQUFBWSxHQUFBakIsT0FBQSxrQ0FBQWlCLEdBQUFOLFNBQUFJLEVBQUF6SSxPQUFBLGdCQUFBc0ksTUFBQXJHLEdBQWtDRixFQUFBIiwiZmlsZSI6InNsYWNrLmpzIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZShcInNvdXJjZS1tYXAtc3VwcG9ydFwiKS5pbnN0YWxsKCk7cmVxdWlyZShcInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZVwiKTtcbihmdW5jdGlvbihlLCBhKSB7IGZvcih2YXIgaSBpbiBhKSBlW2ldID0gYVtpXTsgfShleHBvcnRzLCAvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwXG4vKioqKioqLyBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4vKioqKioqLyBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4vKioqKioqLyBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4vKioqKioqLyBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbi8qKioqKiovIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4vKioqKioqLyBcdFx0XHRpOiBtb2R1bGVJZCxcbi8qKioqKiovIFx0XHRcdGw6IGZhbHNlLFxuLyoqKioqKi8gXHRcdFx0ZXhwb3J0czoge31cbi8qKioqKiovIFx0XHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbi8qKioqKiovIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuLyoqKioqKi8gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbi8qKioqKiovIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4vKioqKioqLyBcdH1cbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGlkZW50aXR5IGZ1bmN0aW9uIGZvciBjYWxsaW5nIGhhcm1vcnkgaW1wb3J0cyB3aXRoIHRoZSBjb3JyZWN0IGNvbnRleHRcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5pID0gZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuIHZhbHVlOyB9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9yeSBleHBvcnRzXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuLyoqKioqKi8gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4vKioqKioqLyBcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuLyoqKioqKi8gXHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbi8qKioqKiovIFx0XHRcdGdldDogZ2V0dGVyXG4vKioqKioqLyBcdFx0fSk7XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbi8qKioqKiovIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbi8qKioqKiovIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4vKioqKioqLyBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuLyoqKioqKi8gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbi8qKioqKiovIFx0XHRyZXR1cm4gZ2V0dGVyO1xuLyoqKioqKi8gXHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8qKioqKiovIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMyk7XG4vKioqKioqLyB9KVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKioqKiovIChbXG4vKiAwICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiQGV4b3BsYXkvZXhvYm90XCIpO1xuXG4vKioqLyB9LFxuLyogMSAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcIkBzbGFjay9jbGllbnRcIik7XG5cbi8qKiovIH0sXG4vKiAyICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiQHNsYWNrL2NsaWVudC9saWIvbW9kZWxzXCIpO1xuXG4vKioqLyB9LFxuLyogMyAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fc2xhY2tfY2xpZW50X18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fc2xhY2tfY2xpZW50X19fZGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18ubihfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX3NsYWNrX2NsaWVudF9fKTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfX3NsYWNrX2NsaWVudF9saWJfbW9kZWxzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fc2xhY2tfY2xpZW50X2xpYl9tb2RlbHNfX19kZWZhdWx0ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5uKF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fc2xhY2tfY2xpZW50X2xpYl9tb2RlbHNfXyk7XG4vKiBoYXJtb255IGltcG9ydCAqLyB2YXIgX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8yX19leG9wbGF5X2V4b2JvdF9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfX2V4b3BsYXlfZXhvYm90X19fZGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18ubihfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfX2V4b3BsYXlfZXhvYm90X18pO1xuLyogaGFybW9ueSBleHBvcnQgKGJpbmRpbmcpICovIF9fd2VicGFja19yZXF1aXJlX18uZChleHBvcnRzLCBcIkVWRU5UU1wiLCBmdW5jdGlvbigpIHsgcmV0dXJuIEVWRU5UUzsgfSk7XG4vKiBoYXJtb255IGV4cG9ydCAoYmluZGluZykgKi8gX193ZWJwYWNrX3JlcXVpcmVfXy5kKGV4cG9ydHMsIFwiU2xhY2tBZGFwdGVyXCIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gU2xhY2tBZGFwdGVyOyB9KTtcbnZhciBfRVZFTlRTO1xuXG5mdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgZ2VuID0gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgZnVuY3Rpb24gc3RlcChrZXksIGFyZykgeyB0cnkgeyB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7IHZhciB2YWx1ZSA9IGluZm8udmFsdWU7IH0gY2F0Y2ggKGVycm9yKSB7IHJlamVjdChlcnJvcik7IHJldHVybjsgfSBpZiAoaW5mby5kb25lKSB7IHJlc29sdmUodmFsdWUpOyB9IGVsc2UgeyByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkgeyBzdGVwKFwibmV4dFwiLCB2YWx1ZSk7IH0sIGZ1bmN0aW9uIChlcnIpIHsgc3RlcChcInRocm93XCIsIGVycik7IH0pOyB9IH0gcmV0dXJuIHN0ZXAoXCJuZXh0XCIpOyB9KTsgfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBjYWxsID09PSBcImZ1bmN0aW9uXCIpID8gY2FsbCA6IHNlbGY7IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gXCJmdW5jdGlvblwiICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgXCIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cblxuXG5cblxuXG5cbnZhciBkbU5hbWUgPSBuZXcgX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19zbGFja19jbGllbnRfbGliX21vZGVsc19fX2RlZmF1bHQuYS5ETSgpLl9tb2RlbE5hbWU7XG5cbnZhciBFVkVOVFMgPSAoX0VWRU5UUyA9IHt9LCBfRVZFTlRTW19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fc2xhY2tfY2xpZW50X19bXCJDTElFTlRfRVZFTlRTXCJdLlJUTS5DT05ORUNUSU5HXSA9ICdzbGFja0Nvbm5lY3RpbmcnLCBfRVZFTlRTW19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fc2xhY2tfY2xpZW50X19bXCJDTElFTlRfRVZFTlRTXCJdLlJUTS5SVE1fQ09OTkVDVElPTl9PUEVORURdID0gJ3NsYWNrQ29ubmVjdGVkJywgX0VWRU5UU1tfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX3NsYWNrX2NsaWVudF9fW1wiQ0xJRU5UX0VWRU5UU1wiXS5SVE0uQVVUSEVOVElDQVRFRF0gPSAnc2xhY2tBdXRoZW50aWNhdGVkJywgX0VWRU5UU1tfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX3NsYWNrX2NsaWVudF9fW1wiQ0xJRU5UX0VWRU5UU1wiXS5SVE0uRElTQ09OTkVDVF0gPSAnc2xhY2tEaXNjb25uZWN0ZWQnLCBfRVZFTlRTW19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fc2xhY2tfY2xpZW50X19bXCJDTElFTlRfRVZFTlRTXCJdLlJUTS5VTkFCTEVfVE9fUlRNX1NUQVJUXSA9ICdzbGFja1VuYWJsZVRvU3RhcnQnLCBfRVZFTlRTW19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fc2xhY2tfY2xpZW50X19bXCJDTElFTlRfRVZFTlRTXCJdLlJUTS5BVFRFTVBUSU5HX1JFQ09OTkVDVF0gPSAnc2xhY2tSZWNvbm5lY3RpbmcnLCBfRVZFTlRTW19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fc2xhY2tfY2xpZW50X19bXCJSVE1fRVZFTlRTXCJdLk1FU1NBR0VdID0gJ3NsYWNrTWVzc2FnZScsIF9FVkVOVFMpO1xuXG52YXIgU2xhY2tBZGFwdGVyID0gZnVuY3Rpb24gKF9BZGFwdGVyKSB7XG4gIF9pbmhlcml0cyhTbGFja0FkYXB0ZXIsIF9BZGFwdGVyKTtcblxuICBmdW5jdGlvbiBTbGFja0FkYXB0ZXIoX3JlZikge1xuICAgIHZhciB0b2tlbiA9IF9yZWYudG9rZW4sXG4gICAgICAgIGFkYXB0ZXJOYW1lID0gX3JlZi5hZGFwdGVyTmFtZTtcblxuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTbGFja0FkYXB0ZXIpO1xuXG4gICAgdmFyIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0FkYXB0ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7XG5cbiAgICBfdGhpcy5uYW1lID0gJ1NsYWNrJztcblxuICAgIF90aGlzLnRva2VuID0gdG9rZW47XG4gICAgX3RoaXMubmFtZSA9IGFkYXB0ZXJOYW1lIHx8IF90aGlzLm5hbWU7XG4gICAgcmV0dXJuIF90aGlzO1xuICB9XG5cbiAgU2xhY2tBZGFwdGVyLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyKGJvdCkge1xuICAgIHZhciBfQWRhcHRlciRwcm90b3R5cGUkcmUsXG4gICAgICAgIF90aGlzMiA9IHRoaXM7XG5cbiAgICAoX0FkYXB0ZXIkcHJvdG90eXBlJHJlID0gX0FkYXB0ZXIucHJvdG90eXBlLnJlZ2lzdGVyKS5jYWxsLmFwcGx5KF9BZGFwdGVyJHByb3RvdHlwZSRyZSwgW3RoaXNdLmNvbmNhdChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7XG4gICAgdmFyIHRva2VuID0gdGhpcy50b2tlbjtcblxuXG4gICAgdGhpcy5jbGllbnQgPSBuZXcgX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19zbGFja19jbGllbnRfX1tcIlJ0bUNsaWVudFwiXSh0b2tlbiwgeyBsb2dMZXZlbDogYm90LmxvZ0xldmVsIH0pO1xuXG4gICAgT2JqZWN0LmtleXMoRVZFTlRTKS5mb3JFYWNoKGZ1bmN0aW9uIChzbGFja0V2ZW50KSB7XG4gICAgICB2YXIgbWFwcGVkRm4gPSBfdGhpczJbRVZFTlRTW3NsYWNrRXZlbnRdXTtcbiAgICAgIF90aGlzMi5jbGllbnQub24oc2xhY2tFdmVudCwgbWFwcGVkRm4uYmluZChfdGhpczIpKTtcbiAgICAgIF90aGlzMi5jbGllbnQub24oc2xhY2tFdmVudCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX2JvdCRlbWl0dGVyO1xuXG4gICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICAgICAgfVxuXG4gICAgICAgIChfYm90JGVtaXR0ZXIgPSBib3QuZW1pdHRlcikuZW1pdC5hcHBseShfYm90JGVtaXR0ZXIsIFsnc2xhY2stJyArIHNsYWNrRXZlbnRdLmNvbmNhdChhcmdzKSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRoaXMuY2xpZW50LnN0YXJ0KCk7XG4gIH07XG5cbiAgU2xhY2tBZGFwdGVyLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gc2VuZChtZXNzYWdlKSB7XG4gICAgaWYgKG1lc3NhZ2UudGV4dCkge1xuICAgICAgdGhpcy5ib3QubG9nLmRlYnVnKCdTZW5kaW5nICcgKyBtZXNzYWdlLnRleHQgKyAnIHRvICcgKyBtZXNzYWdlLmNoYW5uZWwpO1xuICAgICAgdGhpcy5jbGllbnQuc2VuZE1lc3NhZ2UobWVzc2FnZS50ZXh0LCBtZXNzYWdlLmNoYW5uZWwpO1xuICAgIH1cbiAgfTtcblxuICBTbGFja0FkYXB0ZXIucHJvdG90eXBlLnNsYWNrQ29ubmVjdGluZyA9IGZ1bmN0aW9uIHNsYWNrQ29ubmVjdGluZygpIHtcbiAgICB0aGlzLmJvdC5sb2cuaW5mbygnQ29ubmVjdGluZyB0byBTbGFjay4nKTtcbiAgICB0aGlzLnN0YXR1cyA9IF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fZXhvcGxheV9leG9ib3RfX1tcIkFkYXB0ZXJcIl0uU1RBVFVTLkNPTk5FQ1RJTkc7XG4gIH07XG5cbiAgU2xhY2tBZGFwdGVyLnByb3RvdHlwZS5zbGFja0Nvbm5lY3RlZCA9IGZ1bmN0aW9uIHNsYWNrQ29ubmVjdGVkKCkge1xuICAgIHRoaXMuYm90LmxvZy5pbmZvKCdDb25uZWN0ZWQgdG8gU2xhY2suJyk7XG4gIH07XG5cbiAgU2xhY2tBZGFwdGVyLnByb3RvdHlwZS5zbGFja0F1dGhlbnRpY2F0ZWQgPSBmdW5jdGlvbiBzbGFja0F1dGhlbnRpY2F0ZWQoKSB7XG4gICAgdGhpcy5ib3QubG9nLm5vdGljZSgnU3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZWQgdG8gU2xhY2suJyk7XG4gICAgdGhpcy5zdGF0dXMgPSBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfX2V4b3BsYXlfZXhvYm90X19bXCJBZGFwdGVyXCJdLlNUQVRVUy5DT05ORUNURUQ7XG4gIH07XG5cbiAgU2xhY2tBZGFwdGVyLnByb3RvdHlwZS5zbGFja0Rpc2Nvbm5lY3RlZCA9IGZ1bmN0aW9uIHNsYWNrRGlzY29ubmVjdGVkKCkge1xuICAgIHRoaXMuYm90LmxvZy5jcml0aWNhbCgnRGlzY29ubmVjdGVkIGZyb20gU2xhY2suJyk7XG4gICAgdGhpcy5zdGF0dXMgPSBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfX2V4b3BsYXlfZXhvYm90X19bXCJBZGFwdGVyXCJdLlNUQVRVUy5ESVNDT05ORUNURUQ7XG4gIH07XG5cbiAgU2xhY2tBZGFwdGVyLnByb3RvdHlwZS5zbGFja1VuYWJsZVRvU3RhcnQgPSBmdW5jdGlvbiBzbGFja1VuYWJsZVRvU3RhcnQoKSB7XG4gICAgdGhpcy5ib3QubG9nLmNyaXRpY2FsKCdVbmFibGUgdG8gc3RhcnQgU2xhY2suJyk7XG4gICAgdGhpcy5zdGF0dXMgPSBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfX2V4b3BsYXlfZXhvYm90X19bXCJBZGFwdGVyXCJdLlNUQVRVUy5ESVNDT05ORUNURUQ7XG4gIH07XG5cbiAgU2xhY2tBZGFwdGVyLnByb3RvdHlwZS5zbGFja1JlY29ubmVjdGluZyA9IGZ1bmN0aW9uIHNsYWNrUmVjb25uZWN0aW5nKCkge1xuICAgIHRoaXMuYm90LmxvZy5ub3RpY2UoJ1JlY29ubmVjdGluZyB0byBTbGFjay4nKTtcbiAgICB0aGlzLnN0YXR1cyA9IF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fZXhvcGxheV9leG9ib3RfX1tcIkFkYXB0ZXJcIl0uU1RBVFVTLlJFQ09OTkVDVElORztcbiAgfTtcblxuICBTbGFja0FkYXB0ZXIucHJvdG90eXBlLmdldFJvbGVzRm9yVXNlciA9IGZ1bmN0aW9uIGdldFJvbGVzRm9yVXNlcih1c2VySWQpIHtcbiAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgIGlmICh0aGlzLmFkYXB0ZXJVc2VycyAmJiB0aGlzLnJvbGVNYXBwaW5nICYmIHRoaXMuYWRhcHRlclVzZXJzW3VzZXJJZF0pIHtcbiAgICAgIHJldHVybiB0aGlzLmFkYXB0ZXJVc2Vyc1t1c2VySWRdLnJvbGVzLmZpbHRlcihmdW5jdGlvbiAocm9sZSkge1xuICAgICAgICByZXR1cm4gX3RoaXMzLnJvbGVNYXBwaW5nW3JvbGVdO1xuICAgICAgfSkubWFwKGZ1bmN0aW9uIChyb2xlKSB7XG4gICAgICAgIHJldHVybiBfdGhpczMucm9sZU1hcHBpbmdbcm9sZV07XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gW107XG4gIH07XG5cbiAgU2xhY2tBZGFwdGVyLnByb3RvdHlwZS5nZXRSb2xlcyA9IGZ1bmN0aW9uIGdldFJvbGVzKGFkYXB0ZXJVc2VySWQsIGFkYXB0ZXJVc2VyKSB7XG4gICAgdmFyIHJvbGVzID0gW107XG4gICAgaWYgKGFkYXB0ZXJVc2VyKSB7XG4gICAgICBpZiAoYWRhcHRlclVzZXIuaXNfYWRtaW4pIHtcbiAgICAgICAgcm9sZXMucHVzaCgnYWRtaW4nKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGFkYXB0ZXJVc2VyLmlzX293bmVyKSB7XG4gICAgICAgIHJvbGVzLnB1c2goJ293bmVyJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcm9sZXM7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIFNsYWNrQWRhcHRlci5wcm90b3R5cGUuc2xhY2tNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUobWVzc2FnZSkge1xuICAgICAgdmFyIHVzZXIsIGJvdElkLCBzbGFja1VzZXIsIGNoYW5uZWw7XG4gICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHtcbiAgICAgICAgd2hpbGUgKDEpIHtcbiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgIHVzZXIgPSB2b2lkIDA7XG5cbiAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGV4dCkge1xuICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgncmV0dXJuJyk7XG5cbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgYm90SWQgPSB0aGlzLmNsaWVudC5hY3RpdmVVc2VySWQ7XG5cbiAgICAgICAgICAgICAgaWYgKCEobWVzc2FnZS51c2VyID09PSBib3RJZCkpIHtcbiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoJ3JldHVybicpO1xuXG4gICAgICAgICAgICBjYXNlIDY6XG5cbiAgICAgICAgICAgICAgdGhpcy5ib3QubG9nLmRlYnVnKG1lc3NhZ2UudGV4dCk7XG4gICAgICAgICAgICAgIHNsYWNrVXNlciA9IHRoaXMuY2xpZW50LmRhdGFTdG9yZS5nZXRVc2VyQnlJZChtZXNzYWdlLnVzZXIpO1xuXG4gICAgICAgICAgICAgIGlmICghc2xhY2tVc2VyKSB7XG4gICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE0O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExO1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRVc2VyKHNsYWNrVXNlci5pZCwgc2xhY2tVc2VyLm5hbWUsIHNsYWNrVXNlcik7XG5cbiAgICAgICAgICAgIGNhc2UgMTE6XG4gICAgICAgICAgICAgIHVzZXIgPSBfY29udGV4dC5zZW50O1xuICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTc7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIDE0OlxuICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTY7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFVzZXIobWVzc2FnZS51c2VyLCB1bmRlZmluZWQsIHNsYWNrVXNlcik7XG5cbiAgICAgICAgICAgIGNhc2UgMTY6XG4gICAgICAgICAgICAgIHVzZXIgPSBfY29udGV4dC5zZW50O1xuXG4gICAgICAgICAgICBjYXNlIDE3OlxuICAgICAgICAgICAgICBjaGFubmVsID0gdGhpcy5jbGllbnQuZGF0YVN0b3JlLmdldENoYW5uZWxHcm91cE9yRE1CeUlkKG1lc3NhZ2UuY2hhbm5lbCk7XG5cbiAgICAgICAgICAgICAgaWYgKCFtZXNzYWdlLnRleHQpIHtcbiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoIShjaGFubmVsICYmIGNoYW5uZWwuX21vZGVsTmFtZSA9PT0gZG1OYW1lKSkge1xuICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoJ3JldHVybicsIF9BZGFwdGVyLnByb3RvdHlwZS5yZWNlaXZlV2hpc3Blci5jYWxsKHRoaXMsIHsgdXNlcjogdXNlciwgdGV4dDogbWVzc2FnZS50ZXh0LCBjaGFubmVsOiBtZXNzYWdlLmNoYW5uZWwgfSkpO1xuXG4gICAgICAgICAgICBjYXNlIDIxOlxuXG4gICAgICAgICAgICAgIF9BZGFwdGVyLnByb3RvdHlwZS5yZWNlaXZlLmNhbGwodGhpcywgeyB1c2VyOiB1c2VyLCB0ZXh0OiBtZXNzYWdlLnRleHQsIGNoYW5uZWw6IG1lc3NhZ2UuY2hhbm5lbCB9KTtcblxuICAgICAgICAgICAgY2FzZSAyMjpcbiAgICAgICAgICAgIGNhc2UgJ2VuZCc6XG4gICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LCBfY2FsbGVlLCB0aGlzKTtcbiAgICB9KSk7XG5cbiAgICBmdW5jdGlvbiBzbGFja01lc3NhZ2UoX3gpIHtcbiAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIHJldHVybiBzbGFja01lc3NhZ2U7XG4gIH0oKTtcblxuICBTbGFja0FkYXB0ZXIucHJvdG90eXBlLmdldFVzZXJJZEJ5VXNlck5hbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9yZWYzID0gX2FzeW5jVG9HZW5lcmF0b3IocmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIobmFtZSkge1xuICAgICAgdmFyIHVzZXIsIGJvdFVzZXI7XG4gICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0Mikge1xuICAgICAgICB3aGlsZSAoMSkge1xuICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICB1c2VyID0gdGhpcy5jbGllbnQuZGF0YVN0b3JlLmdldFVzZXJCeU5hbWUobmFtZSk7XG5cbiAgICAgICAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGJvdFVzZXIgPSB2b2lkIDA7XG4gICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMztcbiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA2O1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRVc2VyKHVzZXIuaWQsIHVzZXIubmFtZSwgdXNlcik7XG5cbiAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgYm90VXNlciA9IF9jb250ZXh0Mi5zZW50O1xuICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyO1xuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDk7XG4gICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsnY2F0Y2gnXSgzKTtcblxuICAgICAgICAgICAgICB0aGlzLmJvdC5sb2cud2FybihfY29udGV4dDIudDApO1xuXG4gICAgICAgICAgICBjYXNlIDEyOlxuICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgncmV0dXJuJywgYm90VXNlci5pZCk7XG5cbiAgICAgICAgICAgIGNhc2UgMTM6XG4gICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCdyZXR1cm4nKTtcblxuICAgICAgICAgICAgY2FzZSAxNDpcbiAgICAgICAgICAgIGNhc2UgJ2VuZCc6XG4gICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgX2NhbGxlZTIsIHRoaXMsIFtbMywgOV1dKTtcbiAgICB9KSk7XG5cbiAgICBmdW5jdGlvbiBnZXRVc2VySWRCeVVzZXJOYW1lKF94Mikge1xuICAgICAgcmV0dXJuIF9yZWYzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGdldFVzZXJJZEJ5VXNlck5hbWU7XG4gIH0oKTtcblxuICByZXR1cm4gU2xhY2tBZGFwdGVyO1xufShfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfX2V4b3BsYXlfZXhvYm90X19bXCJBZGFwdGVyXCJdKTtcblxuLyoqKi8gfVxuLyoqKioqKi8gXSkpKTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc2xhY2suanMiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcblxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gaWRlbnRpdHkgZnVuY3Rpb24gZm9yIGNhbGxpbmcgaGFybW9yeSBpbXBvcnRzIHdpdGggdGhlIGNvcnJlY3QgY29udGV4dFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5pID0gZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuIHZhbHVlOyB9O1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb3J5IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHR9KTtcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMyk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay9ib290c3RyYXAgM2VkY2I3YjFhZjU2OTAzZjM1NmQiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJAZXhvcGxheS9leG9ib3RcIik7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwgXCJAZXhvcGxheS9leG9ib3RcIlxuLy8gbW9kdWxlIGlkID0gMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJAc2xhY2svY2xpZW50XCIpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIFwiQHNsYWNrL2NsaWVudFwiXG4vLyBtb2R1bGUgaWQgPSAxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcIkBzbGFjay9jbGllbnQvbGliL21vZGVsc1wiKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyBleHRlcm5hbCBcIkBzbGFjay9jbGllbnQvbGliL21vZGVsc1wiXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImltcG9ydCB7XG4gIFJ0bUNsaWVudCxcbiAgQ0xJRU5UX0VWRU5UUyxcbiAgUlRNX0VWRU5UUyxcbiAgLy9NZW1vcnlEYXRhU3RvcmUsXG59IGZyb20gJ0BzbGFjay9jbGllbnQnO1xuXG5pbXBvcnQgbW9kZWxzIGZyb20gJ0BzbGFjay9jbGllbnQvbGliL21vZGVscyc7XG5cbmltcG9ydCB7IEFkYXB0ZXIgfSBmcm9tICdAZXhvcGxheS9leG9ib3QnO1xuXG5jb25zdCBkbU5hbWUgPSBuZXcgbW9kZWxzLkRNKCkuX21vZGVsTmFtZTtcblxuZXhwb3J0IGNvbnN0IEVWRU5UUyA9IHtcbiAgW0NMSUVOVF9FVkVOVFMuUlRNLkNPTk5FQ1RJTkddOiAnc2xhY2tDb25uZWN0aW5nJyxcbiAgW0NMSUVOVF9FVkVOVFMuUlRNLlJUTV9DT05ORUNUSU9OX09QRU5FRF06ICdzbGFja0Nvbm5lY3RlZCcsXG4gIFtDTElFTlRfRVZFTlRTLlJUTS5BVVRIRU5USUNBVEVEXTogJ3NsYWNrQXV0aGVudGljYXRlZCcsXG4gIFtDTElFTlRfRVZFTlRTLlJUTS5ESVNDT05ORUNUXTogJ3NsYWNrRGlzY29ubmVjdGVkJyxcbiAgW0NMSUVOVF9FVkVOVFMuUlRNLlVOQUJMRV9UT19SVE1fU1RBUlRdOiAnc2xhY2tVbmFibGVUb1N0YXJ0JyxcbiAgW0NMSUVOVF9FVkVOVFMuUlRNLkFUVEVNUFRJTkdfUkVDT05ORUNUXTogJ3NsYWNrUmVjb25uZWN0aW5nJyxcbiAgW1JUTV9FVkVOVFMuTUVTU0FHRV06ICdzbGFja01lc3NhZ2UnLFxufTtcblxuZXhwb3J0IGNsYXNzIFNsYWNrQWRhcHRlciBleHRlbmRzIEFkYXB0ZXIge1xuICBuYW1lID0gJ1NsYWNrJztcblxuICBjb25zdHJ1Y3RvciAoeyB0b2tlbiwgYWRhcHRlck5hbWV9KSB7XG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICB0aGlzLnRva2VuID0gdG9rZW47XG4gICAgdGhpcy5uYW1lID0gYWRhcHRlck5hbWUgfHwgdGhpcy5uYW1lO1xuICB9XG5cbiAgcmVnaXN0ZXIgKGJvdCkge1xuICAgIHN1cGVyLnJlZ2lzdGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgY29uc3QgeyB0b2tlbiB9ID0gdGhpcztcblxuICAgIHRoaXMuY2xpZW50ID0gbmV3IFJ0bUNsaWVudCh0b2tlbiwgeyBsb2dMZXZlbDogYm90LmxvZ0xldmVsIH0pO1xuXG4gICAgT2JqZWN0LmtleXMoRVZFTlRTKS5mb3JFYWNoKHNsYWNrRXZlbnQgPT4ge1xuICAgICAgY29uc3QgbWFwcGVkRm4gPSB0aGlzW0VWRU5UU1tzbGFja0V2ZW50XV07XG4gICAgICB0aGlzLmNsaWVudC5vbihzbGFja0V2ZW50LCBtYXBwZWRGbi5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMuY2xpZW50Lm9uKHNsYWNrRXZlbnQsICguLi5hcmdzKSA9PiB7XG4gICAgICAgIGJvdC5lbWl0dGVyLmVtaXQoYHNsYWNrLSR7c2xhY2tFdmVudH1gLCAuLi5hcmdzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGhpcy5jbGllbnQuc3RhcnQoKTtcbiAgfVxuXG4gIHNlbmQgKG1lc3NhZ2UpIHtcbiAgICBpZiAobWVzc2FnZS50ZXh0KSB7XG4gICAgICB0aGlzLmJvdC5sb2cuZGVidWcoYFNlbmRpbmcgJHttZXNzYWdlLnRleHR9IHRvICR7bWVzc2FnZS5jaGFubmVsfWApO1xuICAgICAgdGhpcy5jbGllbnQuc2VuZE1lc3NhZ2UobWVzc2FnZS50ZXh0LCBtZXNzYWdlLmNoYW5uZWwpO1xuICAgIH1cbiAgfVxuXG4gIHNsYWNrQ29ubmVjdGluZyAoKSB7XG4gICAgdGhpcy5ib3QubG9nLmluZm8oJ0Nvbm5lY3RpbmcgdG8gU2xhY2suJyk7XG4gICAgdGhpcy5zdGF0dXMgPSBBZGFwdGVyLlNUQVRVUy5DT05ORUNUSU5HO1xuICB9XG5cbiAgc2xhY2tDb25uZWN0ZWQgKCkge1xuICAgIHRoaXMuYm90LmxvZy5pbmZvKCdDb25uZWN0ZWQgdG8gU2xhY2suJyk7XG4gIH1cblxuICBzbGFja0F1dGhlbnRpY2F0ZWQgKCkge1xuICAgIHRoaXMuYm90LmxvZy5ub3RpY2UoJ1N1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkIHRvIFNsYWNrLicpO1xuICAgIHRoaXMuc3RhdHVzID0gQWRhcHRlci5TVEFUVVMuQ09OTkVDVEVEO1xuICB9XG5cbiAgc2xhY2tEaXNjb25uZWN0ZWQgKCkge1xuICAgIHRoaXMuYm90LmxvZy5jcml0aWNhbCgnRGlzY29ubmVjdGVkIGZyb20gU2xhY2suJyk7XG4gICAgdGhpcy5zdGF0dXMgPSBBZGFwdGVyLlNUQVRVUy5ESVNDT05ORUNURUQ7XG4gIH1cblxuICBzbGFja1VuYWJsZVRvU3RhcnQgKCkge1xuICAgIHRoaXMuYm90LmxvZy5jcml0aWNhbCgnVW5hYmxlIHRvIHN0YXJ0IFNsYWNrLicpO1xuICAgIHRoaXMuc3RhdHVzID0gQWRhcHRlci5TVEFUVVMuRElTQ09OTkVDVEVEO1xuICB9XG5cbiAgc2xhY2tSZWNvbm5lY3RpbmcgKCkge1xuICAgIHRoaXMuYm90LmxvZy5ub3RpY2UoJ1JlY29ubmVjdGluZyB0byBTbGFjay4nKTtcbiAgICB0aGlzLnN0YXR1cyA9IEFkYXB0ZXIuU1RBVFVTLlJFQ09OTkVDVElORztcbiAgfVxuXG4gIGdldFJvbGVzRm9yVXNlciAodXNlcklkKSB7XG4gICAgaWYgKHRoaXMuYWRhcHRlclVzZXJzICYmIHRoaXMucm9sZU1hcHBpbmcgJiYgdGhpcy5hZGFwdGVyVXNlcnNbdXNlcklkXSkge1xuICAgICAgcmV0dXJuIHRoaXMuYWRhcHRlclVzZXJzW3VzZXJJZF0ucm9sZXNcbiAgICAgICAgLmZpbHRlcihyb2xlID0+IHRoaXMucm9sZU1hcHBpbmdbcm9sZV0pXG4gICAgICAgIC5tYXAocm9sZSA9PiB0aGlzLnJvbGVNYXBwaW5nW3JvbGVdKTtcbiAgICB9XG5cbiAgICByZXR1cm4gW107XG4gIH1cblxuICBnZXRSb2xlcyhhZGFwdGVyVXNlcklkLCBhZGFwdGVyVXNlcikge1xuICAgIGNvbnN0IHJvbGVzID0gW107XG4gICAgaWYgKGFkYXB0ZXJVc2VyKSB7XG4gICAgICBpZiAoYWRhcHRlclVzZXIuaXNfYWRtaW4pIHtcbiAgICAgICAgcm9sZXMucHVzaCgnYWRtaW4nKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGFkYXB0ZXJVc2VyLmlzX293bmVyKSB7XG4gICAgICAgIHJvbGVzLnB1c2goJ293bmVyJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcm9sZXM7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgYXN5bmMgc2xhY2tNZXNzYWdlIChtZXNzYWdlKSB7XG4gICAgbGV0IHVzZXI7XG4gICAgaWYgKCFtZXNzYWdlLnRleHQpIHsgcmV0dXJuOyB9XG5cbiAgICBjb25zdCBib3RJZCA9IHRoaXMuY2xpZW50LmFjdGl2ZVVzZXJJZDtcbiAgICBpZiAobWVzc2FnZS51c2VyID09PSBib3RJZCkgeyByZXR1cm47IH1cblxuICAgIHRoaXMuYm90LmxvZy5kZWJ1ZyhtZXNzYWdlLnRleHQpO1xuICAgIGNvbnN0IHNsYWNrVXNlciA9IHRoaXMuY2xpZW50LmRhdGFTdG9yZS5nZXRVc2VyQnlJZChtZXNzYWdlLnVzZXIpO1xuXG4gICAgaWYgKHNsYWNrVXNlcikge1xuICAgICAgdXNlciA9IGF3YWl0IHRoaXMuZ2V0VXNlcihzbGFja1VzZXIuaWQsIHNsYWNrVXNlci5uYW1lLCBzbGFja1VzZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB1c2VyID0gYXdhaXQgdGhpcy5nZXRVc2VyKG1lc3NhZ2UudXNlciwgdW5kZWZpbmVkLCBzbGFja1VzZXIpO1xuICAgIH1cblxuICAgIGNvbnN0IGNoYW5uZWwgPSB0aGlzLmNsaWVudC5kYXRhU3RvcmUuZ2V0Q2hhbm5lbEdyb3VwT3JETUJ5SWQobWVzc2FnZS5jaGFubmVsKTtcblxuICAgIGlmIChtZXNzYWdlLnRleHQpIHtcbiAgICAgIGlmIChjaGFubmVsICYmIGNoYW5uZWwuX21vZGVsTmFtZSA9PT0gZG1OYW1lKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5yZWNlaXZlV2hpc3Blcih7IHVzZXIsIHRleHQ6IG1lc3NhZ2UudGV4dCwgY2hhbm5lbDogbWVzc2FnZS5jaGFubmVsIH0pO1xuICAgICAgfVxuXG4gICAgICBzdXBlci5yZWNlaXZlKHsgdXNlciwgdGV4dDogbWVzc2FnZS50ZXh0LCBjaGFubmVsOiBtZXNzYWdlLmNoYW5uZWwgfSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0VXNlcklkQnlVc2VyTmFtZSAobmFtZSkge1xuICAgIGNvbnN0IHVzZXIgPSB0aGlzLmNsaWVudC5kYXRhU3RvcmUuZ2V0VXNlckJ5TmFtZShuYW1lKTtcbiAgICBpZiAodXNlcikge1xuICAgICAgbGV0IGJvdFVzZXI7XG4gICAgICB0cnkge1xuICAgICAgICBib3RVc2VyID0gYXdhaXQgdGhpcy5nZXRVc2VyKHVzZXIuaWQsIHVzZXIubmFtZSwgdXNlcik7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhpcy5ib3QubG9nLndhcm4oZXJyKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gYm90VXNlci5pZDtcbiAgICB9XG5cbiAgICByZXR1cm47XG4gIH1cbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NsYWNrLmpzIl0sInNvdXJjZVJvb3QiOiIifQ==